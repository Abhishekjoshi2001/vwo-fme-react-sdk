
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("vwo-fme-node-sdk")):"function"==typeof define&&define.amd?define(["exports","react","vwo-fme-node-sdk"],t):t((e=e||self)["vwo-fme-react-sdk"]={},e.React,e.vwoFmeNodeSdk)}(this,(function(e,t,r){"use strict";var o,n,i="default"in t?t.default:t;!function(e){e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(o||(o={}));class s{constructor(e={}){this.config=e,this.level=this.config.level}trace(e){this.consoleLog(o.TRACE,e)}debug(e){this.consoleLog(o.DEBUG,e)}info(e){this.consoleLog(o.INFO,e)}warn(e){this.consoleLog(o.WARN,e)}error(e){this.consoleLog(o.ERROR,e)}consoleLog(e,t){console[e](t)}}class a{constructor(e,t){this.loggerConfig=e,this.transportConfig=t,this.prefix=this.transportConfig.prefix||this.loggerConfig.prefix||"",this.dateTimeFormat=this.transportConfig.dateTimeFormat||this.loggerConfig.dateTimeFormat}formatMessage(e,t){return`[${this.getFormattedLevel(e)}]: ${this.getFormattedPrefix(this.prefix)} ${this.getFormattedDateTime()} ${t}`}getFormattedPrefix(e){return""+e}getFormattedLevel(e){const t=e.toUpperCase();let r;return r={[o.TRACE]:t,[o.DEBUG]:t,[o.INFO]:t,[o.WARN]:t,[o.ERROR]:t},r[e]}getFormattedDateTime(){return this.dateTimeFormat()}}function l(e){return"[object Function]"===Object.prototype.toString.call(e)}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}!function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(n||(n={}));class u{constructor(e){this.transports=[],this.config=e}addTransport(e){this.transports.push(e)}shouldLog(e,t){return n[e.toUpperCase()]>=n[(t||this.config.level).toUpperCase()]}trace(e){this.log(o.TRACE,e)}debug(e){this.log(o.DEBUG,e)}info(e){this.log(o.INFO,e)}warn(e){this.log(o.WARN,e)}error(e){this.log(o.ERROR,e)}log(e,t){for(let r=0;r<this.transports.length;r++){const o=new a(this.config,this.transports[r]).formatMessage(e,t);this.shouldLog(e,this.transports[r].level)&&(this.transports[r].log&&l(this.transports[r].log)?this.transports[r].log(e,t):this.transports[r][e](o))}}}class _ extends class{}{constructor(e){return super(),this.name="VWO Logger",this.requestId=(new Date).getTime().toString(),this.level=o.ERROR,this.prefix="VWO-SDK",this.config=e,!e.isAlwaysNewInstance&&_.instance||(_.instance=this,this.config.name=e.name||this.name,this.config.requestId=e.requestId||this.requestId,this.config.level=e.level||this.level,this.config.prefix=e.prefix||this.prefix,this.config.dateTimeFormat=e.dateTimeFormat||this.dateTimeFormat,this.transportManager=new u(this.config),this.handleTransports()),_.instance}dateTimeFormat(){return(new Date).toISOString()}static get Instance(){return _.instance}handleTransports(){this.addTransport(new s({level:this.config.level}))}addTransport(e){this.transportManager.addTransport(e)}addTransports(e){for(let t=0;t<e.length;t++)this.addTransport(e[t])}trace(e){this.transportManager.log(o.TRACE,e)}debug(e){this.transportManager.log(o.DEBUG,e)}info(e){this.transportManager.log(o.INFO,e)}warn(e){this.transportManager.log(o.WARN,e)}error(e){this.transportManager.log(o.ERROR,e)}}let c=null;function R(e){return c||(c=new _((null==e?void 0:e.logger)||{})),c}function g(){return c||(c=new _({level:"error"})),c}var O;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(O||(O={}));const T=/\{([0-9a-zA-Z_]+)\}/g;function h(e,t={}){try{return e.replace(T,(r,o,n)=>{if("{"===e[n-1]&&"}"===e[n+r.length])return o;const i=t[o];return null==i?"":l(i)?i():i})}catch(t){return e}}var d;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(d||(d={}));const f=t.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),A=()=>{const e=g();try{return t.useContext(f)||(e.error(h(O.INVALID_HOOK_USAGE,{hookName:d.VWO_CONTEXT})),null)}catch(t){return e.error(h(O.HOOK_ERROR,{error:t,hookName:d.VWO_CONTEXT})),null}},V={vwoClient:null,isReady:!1};Object.defineProperty(e,"Flag",{enumerable:!0,get:function(){return r.Flag}}),Object.defineProperty(e,"LogLevelEnum",{enumerable:!0,get:function(){return r.LogLevelEnum}}),Object.defineProperty(e,"StorageConnector",{enumerable:!0,get:function(){return r.StorageConnector}}),Object.defineProperty(e,"init",{enumerable:!0,get:function(){return r.init}}),e.VWOProvider=function(e){const{userContext:o,children:n,fallbackComponent:s}=e,a="client"in e?e.client:null,l="config"in e?e.config:null,[E,u]=t.useState(a||null),[_,c]=t.useState(o||null),[g,T]=t.useState(!1),d=R((null==a?void 0:a.options)||l),A=t.useMemo(()=>l||(null==a?void 0:a.options),[]);return t.useEffect(()=>{l&&E&&d.warn(O.VWO_PROVIDER_CLIENT_CONFIG_WARNING),E?T(!0):l?!E&&l&&(async()=>{try{if(!E&&l){const e=await r.init(l);u(e),T(!0)}}catch(e){d.error(h(O.VWO_SDK_INITIALIZATION_FAILED,{error:e}))}})():d.error(O.VWO_PROVIDER_CONFIG_REQUIRED)},[A]),i.createElement(f.Provider,{value:{vwoClient:E,userContext:_,setUserContext:c,isReady:g}},s&&!g?s:n)},e.useGetFlag=(e,r)=>{const{vwoClient:o,userContext:n,setUserContext:i,isReady:s}=A(),[a,l]=t.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,t)=>t}),[u,_]=t.useState(!0),c=g(),R=t.useMemo(()=>r||n||{},[JSON.stringify(r||n||{})]),T=t.useCallback(async()=>{try{if(!s)return void c.error(O.VWO_NOT_READY_IN_USE_GET_FLAG);const t=await o.getFlag(e,R);l(t),i(R)}catch(t){c.error(h(O.VWO_GET_FLAG_ERROR,{featureKey:e,error:t}))}finally{_(!1)}},[e,R,s]);return t.useEffect(()=>{e?E(R)&&R.id?s&&o&&R&&T():c.error(h(O.INVALID_CONTEXT,{hookName:d.VWO_GET_FLAG})):c.error(O.VWO_GET_FLAG_FEATURE_KEY_REQUIRED)},[e,JSON.stringify(R),s]),{flag:a,isReady:!u&&!!a}},e.useGetFlagVariable=(e,t,r)=>{const o=g();try{return e&&E(e)?t?e.getVariable(t,r):(o.error(O.VWO_GET_FLAG_VARIABLE_REQUIRED),r):r}catch(e){return o.error(h(O.VWO_GET_FLAG_VARIABLE_ERROR,{error:e})),r}},e.useGetFlagVariables=e=>{const t=g();try{return e&&E(e)?e.getVariables():(t.error(O.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return t.error(h(O.VWO_GET_FLAG_VARIABLES_ERROR,{error:e})),[]}},e.useSetAttribute=()=>{const e=g(),{vwoClient:t,userContext:r,isReady:o}=A();return{setAttribute:n=>{if(o)if(r&&E(r)&&r.id)if(n&&E(n)&&0!==Object.keys(n).length)try{t.setAttribute(n,r),e.info(h(O.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(n)}))}catch(t){e.error(h(O.VWO_SET_ATTRIBUTE_ERROR,{error:t}))}else e.error(O.VWO_SET_ATTRIBUTE_MAP_REQUIRED);else e.error(h(O.INVALID_CONTEXT,{hookName:d.VWO_SET_ATTRIBUTE}));else e.error(h(O.VWO_CLIENT_MISSING,{hookName:d.VWO_SET_ATTRIBUTE}))},isReady:o}},e.useTrackEvent=()=>{const e=g(),{vwoClient:t,userContext:r,isReady:o}=A();return{trackEvent:async(n,i={})=>{if(!o)return e.error(h(O.VWO_CLIENT_MISSING,{hookName:d.VWO_TRACK_EVENT})),Promise.resolve({});if(!n||"string"!=typeof(s=n)&&"[object String]"!==Object.prototype.toString.call(s))return e.error(O.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({});var s;if(!r||!E(r)||!r.id)return e.error(h(O.INVALID_CONTEXT,{hookName:d.VWO_TRACK_EVENT})),Promise.resolve({});try{return await t.trackEvent(n,r,i)}catch(t){return e.error(h(O.VWO_TRACK_EVENT_ERROR,{eventName:n,error:t instanceof Error?t.message:t})),Promise.resolve({})}},isReady:o}},e.useVWOClient=()=>{const e=g();try{const t=A();return t?t.isReady?{vwoClient:t.vwoClient,isReady:!0}:V:(e.error(h(O.INVALID_HOOK_USAGE,{hookName:d.VWO_CLIENT})),V)}catch(t){return e.error(h(O.HOOK_ERROR,{error:t,hookName:d.VWO_CLIENT})),V}},e.useVWOContext=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vwo-fme-react-sdk.umd.production.min.js.map
