
/**
 * Copyright 2025 Wingify Software Pvt. Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r,t,o=require("react"),n=(e=o)&&"object"==typeof e&&"default"in e?e.default:e,s=require("vwo-fme-node-sdk");!function(e){e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(r||(r={}));class i{constructor(e={}){this.config=e,this.level=this.config.level}trace(e){this.consoleLog(r.TRACE,e)}debug(e){this.consoleLog(r.DEBUG,e)}info(e){this.consoleLog(r.INFO,e)}warn(e){this.consoleLog(r.WARN,e)}error(e){this.consoleLog(r.ERROR,e)}consoleLog(e,r){console[e](r)}}class a{constructor(e,r){this.loggerConfig=e,this.transportConfig=r,this.prefix=this.transportConfig.prefix||this.loggerConfig.prefix||"",this.dateTimeFormat=this.transportConfig.dateTimeFormat||this.loggerConfig.dateTimeFormat}formatMessage(e,r){return`[${this.getFormattedLevel(e)}]: ${this.getFormattedPrefix(this.prefix)} ${this.getFormattedDateTime()} ${r}`}getFormattedPrefix(e){return""+e}getFormattedLevel(e){const t=e.toUpperCase();let o;return o={[r.TRACE]:t,[r.DEBUG]:t,[r.INFO]:t,[r.WARN]:t,[r.ERROR]:t},o[e]}getFormattedDateTime(){return this.dateTimeFormat()}}function l(e){return"[object Function]"===Object.prototype.toString.call(e)}function E(e){return"[object Object]"===Object.prototype.toString.call(e)}!function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(t||(t={}));class _{constructor(e){this.transports=[],this.config=e}addTransport(e){this.transports.push(e)}shouldLog(e,r){return t[e.toUpperCase()]>=t[(r||this.config.level).toUpperCase()]}trace(e){this.log(r.TRACE,e)}debug(e){this.log(r.DEBUG,e)}info(e){this.log(r.INFO,e)}warn(e){this.log(r.WARN,e)}error(e){this.log(r.ERROR,e)}log(e,r){for(let t=0;t<this.transports.length;t++){const o=new a(this.config,this.transports[t]).formatMessage(e,r);this.shouldLog(e,this.transports[t].level)&&(this.transports[t].log&&l(this.transports[t].log)?this.transports[t].log(e,r):this.transports[t][e](o))}}}class u extends class{}{constructor(e){return super(),this.name="VWO Logger",this.requestId=(new Date).getTime().toString(),this.level=r.ERROR,this.prefix="VWO-SDK",this.config=e,!e.isAlwaysNewInstance&&u.instance||(u.instance=this,this.config.name=e.name||this.name,this.config.requestId=e.requestId||this.requestId,this.config.level=e.level||this.level,this.config.prefix=e.prefix||this.prefix,this.config.dateTimeFormat=e.dateTimeFormat||this.dateTimeFormat,this.transportManager=new _(this.config),this.handleTransports()),u.instance}dateTimeFormat(){return(new Date).toISOString()}static get Instance(){return u.instance}handleTransports(){this.addTransport(new i({level:this.config.level}))}addTransport(e){this.transportManager.addTransport(e)}addTransports(e){for(let r=0;r<e.length;r++)this.addTransport(e[r])}trace(e){this.transportManager.log(r.TRACE,e)}debug(e){this.transportManager.log(r.DEBUG,e)}info(e){this.transportManager.log(r.INFO,e)}warn(e){this.transportManager.log(r.WARN,e)}error(e){this.transportManager.log(r.ERROR,e)}}let R=null;function c(e){return R||(R=new u((null==e?void 0:e.logger)||{})),R}function O(){return R||(R=new u({level:"error"})),R}var g;!function(e){e.VWO_CLIENT_MISSING="VWO Client is missing in {hookName} hook. Ensure VWOProvider is correctly initialized.",e.INVALID_CONTEXT="Invalid user context in {hookName} hook. Ensure a valid userContext is provided.",e.HOOK_ERROR="Error in {hookName} hook: {error}",e.INVALID_HOOK_USAGE="{hookName} must be used within a VWOProvider !!",e.VWO_PROVIDER_CLIENT_CONFIG_WARNING="VWOProvider Warning: Both `client` and `config` are provided. The `client` prop will take precedence, and the `config` props will be disregarded.",e.VWO_PROVIDER_CONFIG_REQUIRED="VWOProvider Error: Either `client` or `config` must be provided.",e.VWO_SDK_INITIALIZATION_FAILED="VWO-SDK Initialization failed: {error}",e.VWO_TRACK_EVENT_NAME_REQUIRED="Event name is required for useTrackEvent hook and it should be a string",e.VWO_TRACK_EVENT_ERROR="Error tracking event - {eventName}: {error}",e.VWO_SET_ATTRIBUTE_MAP_REQUIRED="attributeMap (object having key-value pairs of user attributes) is required for useSetAttribute hook",e.VWO_SET_ATTRIBUTE_ERROR="Error setting attributes: {error}",e.VWO_SET_ATTRIBUTE_SUCCESS="User attributes set: {attributes}",e.VWO_NOT_READY_IN_USE_GET_FLAG="VWO is not ready in useGetFlag hook",e.VWO_GET_FLAG_FEATURE_KEY_REQUIRED="Feature key is required for useGetFlag hook",e.VWO_GET_FLAG_ERROR="Error fetching feature flag - {featureKey}: {error}",e.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED="Flag is required for useGetFlagVariables hook and should be an object",e.VWO_GET_FLAG_VARIABLES_ERROR="Error getting flag variables: {error}",e.VWO_GET_FLAG_VARIABLE_REQUIRED="Flag and variable key are required for useGetFlagVariable hook",e.VWO_GET_FLAG_VARIABLE_ERROR="Error getting flag variable: {error}"}(g||(g={}));const T=/\{([0-9a-zA-Z_]+)\}/g;function h(e,r={}){try{return e.replace(T,(t,o,n)=>{if("{"===e[n-1]&&"}"===e[n+t.length])return o;const s=r[o];return null==s?"":l(s)?s():s})}catch(r){return e}}var d;!function(e){e.VWO_CLIENT="useVWOClient",e.VWO_CONTEXT="useVWOContext",e.VWO_GET_FLAG="useGetFlag",e.VWO_GET_FLAG_VARIABLE="useGetFlagVariable",e.VWO_GET_FLAG_VARIABLES="useGetFlagVariables",e.VWO_TRACK_EVENT="useTrackEvent",e.VWO_SET_ATTRIBUTE="useSetAttribute"}(d||(d={}));const A=o.createContext({vwoClient:null,userContext:null,setUserContext:void 0,isReady:!1}),V=()=>{const e=O();try{return o.useContext(A)||(e.error(h(g.INVALID_HOOK_USAGE,{hookName:d.VWO_CONTEXT})),null)}catch(r){return e.error(h(g.HOOK_ERROR,{error:r,hookName:d.VWO_CONTEXT})),null}},f={vwoClient:null,isReady:!1};Object.defineProperty(exports,"Flag",{enumerable:!0,get:function(){return s.Flag}}),Object.defineProperty(exports,"StorageConnector",{enumerable:!0,get:function(){return s.StorageConnector}}),Object.defineProperty(exports,"init",{enumerable:!0,get:function(){return s.init}}),exports.VWOProvider=function(e){const{userContext:r,children:t,fallbackComponent:i}=e,a="client"in e?e.client:null,l="config"in e?e.config:null,[E,_]=o.useState(a||null),[u,R]=o.useState(r||null),[O,T]=o.useState(!1),d=c((null==a?void 0:a.options)||l),V=o.useMemo(()=>l||(null==a?void 0:a.options),[]);return o.useEffect(()=>{l&&E&&d.warn(g.VWO_PROVIDER_CLIENT_CONFIG_WARNING),E?T(!0):l?!E&&l&&(async()=>{try{if(!E&&l){const e=await s.init(l);_(e),T(!0)}}catch(e){d.error(h(g.VWO_SDK_INITIALIZATION_FAILED,{error:e}))}})():d.error(g.VWO_PROVIDER_CONFIG_REQUIRED)},[V]),n.createElement(A.Provider,{value:{vwoClient:E,userContext:u,setUserContext:R,isReady:O}},i&&!O?i:t)},exports.useGetFlag=(e,r)=>{const{vwoClient:t,userContext:n,setUserContext:s,isReady:i}=V(),[a,l]=o.useState({isEnabled:()=>!1,getVariables:()=>[],getVariable:(e,r)=>r}),[_,u]=o.useState(!0),R=O(),c=o.useMemo(()=>r||n||{},[JSON.stringify(r||n||{})]),T=o.useCallback(async()=>{try{if(!i)return void R.error(g.VWO_NOT_READY_IN_USE_GET_FLAG);const r=await t.getFlag(e,c);l(r),s(c)}catch(r){R.error(h(g.VWO_GET_FLAG_ERROR,{featureKey:e,error:r}))}finally{u(!1)}},[e,c,i]);return o.useEffect(()=>{e?E(c)&&c.id?i&&t&&c&&T():R.error(h(g.INVALID_CONTEXT,{hookName:d.VWO_GET_FLAG})):R.error(g.VWO_GET_FLAG_FEATURE_KEY_REQUIRED)},[e,JSON.stringify(c),i]),{flag:a,isReady:!_&&!!a}},exports.useGetFlagVariable=(e,r,t)=>{const o=O();try{return e&&E(e)?r?e.getVariable(r,t):(o.error(g.VWO_GET_FLAG_VARIABLE_REQUIRED),t):t}catch(e){return o.error(h(g.VWO_GET_FLAG_VARIABLE_ERROR,{error:e})),t}},exports.useGetFlagVariables=e=>{const r=O();try{return e&&E(e)?e.getVariables():(r.error(g.VWO_GET_FLAG_VARIABLES_FLAG_REQUIRED),[])}catch(e){return r.error(h(g.VWO_GET_FLAG_VARIABLES_ERROR,{error:e})),[]}},exports.useSetAttribute=()=>{const e=O(),{vwoClient:r,userContext:t,isReady:o}=V();return{setAttribute:n=>{if(o)if(t&&E(t)&&t.id)if(n&&E(n)&&0!==Object.keys(n).length)try{r.setAttribute(n,t),e.info(h(g.VWO_SET_ATTRIBUTE_SUCCESS,{attributes:JSON.stringify(n)}))}catch(r){e.error(h(g.VWO_SET_ATTRIBUTE_ERROR,{error:r}))}else e.error(g.VWO_SET_ATTRIBUTE_MAP_REQUIRED);else e.error(h(g.INVALID_CONTEXT,{hookName:d.VWO_SET_ATTRIBUTE}));else e.error(h(g.VWO_CLIENT_MISSING,{hookName:d.VWO_SET_ATTRIBUTE}))},isReady:o}},exports.useTrackEvent=()=>{const e=O(),{vwoClient:r,userContext:t,isReady:o}=V();return{trackEvent:async(n,s={})=>{if(!o)return e.error(h(g.VWO_CLIENT_MISSING,{hookName:d.VWO_TRACK_EVENT})),Promise.resolve({});if(!n||"string"!=typeof(i=n)&&"[object String]"!==Object.prototype.toString.call(i))return e.error(g.VWO_TRACK_EVENT_NAME_REQUIRED),Promise.resolve({});var i;if(!t||!E(t)||!t.id)return e.error(h(g.INVALID_CONTEXT,{hookName:d.VWO_TRACK_EVENT})),Promise.resolve({});try{return await r.trackEvent(n,t,s)}catch(r){return e.error(h(g.VWO_TRACK_EVENT_ERROR,{eventName:n,error:r instanceof Error?r.message:r})),Promise.resolve({})}},isReady:o}},exports.useVWOClient=()=>{const e=O();try{const r=V();return r?r.isReady?{vwoClient:r.vwoClient,isReady:!0}:f:(e.error(h(g.INVALID_HOOK_USAGE,{hookName:d.VWO_CLIENT})),f)}catch(r){return e.error(h(g.HOOK_ERROR,{error:r,hookName:d.VWO_CLIENT})),f}},exports.useVWOContext=V;
//# sourceMappingURL=vwo-fme-react-sdk.cjs.production.min.js.map
